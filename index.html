<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Public Chat - DragonVR's Realm</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;700&display=swap');

body {
  margin: 0;
  background: linear-gradient(180deg, #0b0a0f 0%, #1a120b 80%);
  color: #fff;
  font-family: 'Montserrat', sans-serif;
}

header {
  background: #330b00;
  padding: 1rem;
  font-family: 'Anton', sans-serif;
  color: #ff4500;
  font-size: 2.5rem;
  text-align: center;
}

#ownerStatus {
  text-align: center;
  font-weight: 700;
  margin: 0.5rem;
  color: #aaa;
}

#ownerStatus.online {
  color: #00ff7f;
}

main {
  max-width: 900px;
  margin: 1rem auto;
  padding: 1rem;
}

#chatWindow {
  background: #1a0b00;
  border: 2px solid #ff4500;
  border-radius: 12px;
  height: 400px;
  padding: 1rem;
  overflow-y: auto;
}

.message {
  margin-bottom: 0.7rem;
  padding: 0.4rem 0.6rem;
  border-radius: 8px;
  background: rgba(255,69,0,0.2);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.owner-crown {
  font-size: 1.1rem;
  color: gold;
}

.username {
  font-weight: 700;
  color: #ff6a00;
}

form {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
}

input {
  padding: 0.5rem;
  border-radius: 20px;
  border: 2px solid #ff4500;
  background: #220900;
  color: #fff;
}

button {
  background: #ff4500;
  border: none;
  border-radius: 20px;
  padding: 0 1.2rem;
  font-weight: bold;
  cursor: pointer;
  opacity: 0.6;
}

button.enabled {
  opacity: 1;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<header>ðŸ”¥ DragonVR Live Chat ðŸ”¥</header>
<div id="ownerStatus">Owner offline</div>

<main>
  <div id="chatWindow"></div>

  <form id="chatForm">
    <input id="username" placeholder="Name" maxlength="20" required />
    <input id="messageInput" placeholder="Message" maxlength="200" required />
    <button id="sendBtn" type="submit">Send</button>
  </form>
</main>

<script>
// ---------------- CONFIG ----------------
const OWNER_TOKEN_SECRET = "Dragon-IS-A-LEGEND!!!";
const COOLDOWN_MS = 3000;
const profanity = ["fuck","shit","bitch","asshole","dick"];

// ---------------- FIREBASE ----------------
firebase.initializeApp({
  apiKey: "AIzaSyDIjJYvHsSKg3IRHlmynXFmfPri98nrtLU",
  authDomain: "dragonvr-s-realm-d91d0.firebaseapp.com",
  databaseURL: "https://dragonvr-s-realm-d91d0-default-rtdb.firebaseio.com",
  projectId: "dragonvr-s-realm-d91d0",
});

const db = firebase.database();
const messagesRef = db.ref("chatMessages");
const ownerRef = db.ref("ownerOnline");

// ---------------- DOM ----------------
const chatWindow = document.getElementById("chatWindow");
const chatForm = document.getElementById("chatForm");
const usernameInput = document.getElementById("username");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const ownerStatus = document.getElementById("ownerStatus");

let lastMessageTime = 0;
let slowMode = false;

// ---------------- OWNER DETECTION ----------------
const isOwner = localStorage.getItem("ownerToken") === OWNER_TOKEN_SECRET;

// Owner online indicator
if (isOwner) {
  ownerRef.set(true);
  window.addEventListener("beforeunload", () => ownerRef.set(false));
}

ownerRef.on("value", snap => {
  ownerStatus.textContent = snap.val() ? "ðŸŸ¢ Owner online" : "Owner offline";
  ownerStatus.className = snap.val() ? "online" : "";
});

// ---------------- UTILS ----------------
function cleanText(t) {
  profanity.forEach(w => {
    t = t.replace(new RegExp(w,"gi"), "****");
  });
  return t;
}

function addMessage(msg) {
  const div = document.createElement("div");
  div.className = "message";

  if (msg.ownerToken && msg.ownerToken === localStorage.getItem("ownerToken")) {
    div.innerHTML += `<span class="owner-crown">ðŸ‘‘</span>`;
  }

  div.innerHTML += `<span class="username">${msg.username}:</span> ${msg.text}`;
  chatWindow.appendChild(div);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

// ---------------- LISTENER ----------------
messagesRef.limitToLast(100).on("child_added", s => addMessage(s.val()));

// ---------------- SEND ----------------
chatForm.addEventListener("submit", e => {
  e.preventDefault();
  const now = Date.now();
  if (now - lastMessageTime < COOLDOWN_MS || slowMode && !isOwner) return;

  let text = cleanText(messageInput.value.trim());
  const username = usernameInput.value.trim();
  if (!text || !username) return;

  // Owner commands
  if (isOwner && text.startsWith("/")) {
    if (text === "/clear") messagesRef.remove();
    if (text === "/slowmode on") slowMode = true;
    if (text === "/slowmode off") slowMode = false;
    messageInput.value = "";
    return;
  }

  messagesRef.push({
    username,
    text,
    ownerToken: localStorage.getItem("ownerToken") || null,
    time: Date.now()
  });

  messageInput.value = "";
  lastMessageTime = now;
});

sendBtn.classList.add("enabled");
</script>

</body>
</html>
