<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Public Chat - DragonVR's Realm</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;700&display=swap');

/* === ORIGINAL STYLE (UNCHANGED) === */
body {
  margin: 0;
  background: linear-gradient(180deg, #0b0a0f 0%, #1a120b 80%);
  color: #fff;
  font-family: 'Montserrat', sans-serif;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}
header {
  background: #330b00;
  padding: 1rem 2rem;
  font-family: 'Anton', sans-serif;
  color: #ff4500;
  text-transform: uppercase;
  font-size: 2.8rem;
  letter-spacing: 4px;
  box-shadow: inset 0 0 20px #ff4500;
  text-align: center;
}
#ownerStatus {
  font-size: 1rem;
  color: #0f0;
  text-shadow: 0 0 6px #0f0;
}
main {
  flex-grow: 1;
  max-width: 900px;
  margin: 2rem auto;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
#chatWindow {
  background: #1a0b00;
  border: 2px solid #ff4500;
  border-radius: 12px;
  height: 400px;
  padding: 1rem;
  overflow-y: auto;
}
.message {
  margin-bottom: 0.8rem;
  padding: 0.4rem 0.6rem;
  border-radius: 8px;
  background: rgba(255, 69, 0, 0.2);
  box-shadow: 0 0 6px #ff4500aa;
  display: flex;
  gap: 0.4rem;
  align-items: center;
}
.owner-crown {
  font-size: 1.2rem;
  filter: drop-shadow(0 0 6px gold);
}
.username {
  font-weight: 700;
  color: #ff6a00;
}
form {
  display: flex;
  gap: 0.75rem;
}
input {
  flex-grow: 1;
  border: 2px solid #ff4500;
  border-radius: 25px;
  padding: 0.5rem 1rem;
  background: #220900;
  color: #fff;
}
button {
  background: #ff4500;
  border: none;
  border-radius: 25px;
  padding: 0 1.5rem;
  color: #fff;
  font-weight: 700;
  cursor: pointer;
  opacity: 0.6;
}
button.enabled {
  opacity: 1;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<header>
  Public Chat
  <div id="ownerStatus"></div>
</header>

<main>
  <div id="chatWindow"></div>

  <form id="chatForm">
    <input id="username" placeholder="Your name" maxlength="20" required>
    <input id="messageInput" placeholder="Type your message..." maxlength="200" required>
    <button id="sendBtn">Send</button>
  </form>
</main>

<script>
// ================= OWNER =================
const OWNER_SECRET = "Dragon-IS-A-LEGEND!!!";
const isOwner = localStorage.getItem("ownerToken") === OWNER_SECRET;

// ================= FIREBASE =================
firebase.initializeApp({
  apiKey: "AIzaSyDIjJYvHsSKg3IRHlmynXFmfPri98nrtLU",
  authDomain: "dragonvr-s-realm-d91d0.firebaseapp.com",
  databaseURL: "https://dragonvr-s-realm-d91d0-default-rtdb.firebaseio.com",
  projectId: "dragonvr-s-realm-d91d0"
});

const db = firebase.database();
const messagesRef = db.ref("chatMessages");

// ================= DOM =================
const chatWindow = document.getElementById("chatWindow");
const chatForm = document.getElementById("chatForm");
const usernameInput = document.getElementById("username");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const ownerStatus = document.getElementById("ownerStatus");

// ================= OWNER STATUS =================
if (isOwner) ownerStatus.textContent = "ðŸ‘‘ Owner Online";

// ================= BUTTON STATE =================
function updateBtn() {
  sendBtn.classList.toggle("enabled", usernameInput.value && messageInput.value);
}
usernameInput.oninput = updateBtn;
messageInput.oninput = updateBtn;

// ================= ADD MESSAGE =================
function addMessage(msg) {
  const div = document.createElement("div");
  div.className = "message";

  if (msg.isOwner) {
    const crown = document.createElement("span");
    crown.className = "owner-crown";
    crown.textContent = "ðŸ‘‘";
    div.appendChild(crown);
  }

  const user = document.createElement("span");
  user.className = "username";
  user.textContent = msg.username + ":";

  const text = document.createElement("span");
  text.textContent = " " + msg.text;

  div.append(user, text);
  chatWindow.appendChild(div);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

// ================= LIVE CHAT =================
messagesRef.limitToLast(100).on("child_added", snap => {
  addMessage(snap.val());
});

// ================= SEND MESSAGE =================
chatForm.addEventListener("submit", e => {
  e.preventDefault();

  const username = usernameInput.value.trim();
  const text = messageInput.value.trim();
  if (!username || !text) return;

  // OWNER COMMANDS
  if (isOwner && text.startsWith("/")) {
    if (text === "/clear") {
      messagesRef.remove();
      chatWindow.innerHTML = "";
      messageInput.value = "";
      return;
    }
    if (text.startsWith("/announce ")) {
      messagesRef.push({
        username: "Announcement",
        text: text.replace("/announce ",""),
        isOwner: true
      });
      messageInput.value = "";
      return;
    }
  }

  messagesRef.push({
    username,
    text,
    isOwner
  });

  messageInput.value = "";
  updateBtn();
});
</script>

</body>
</html>
