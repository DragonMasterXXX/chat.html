<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Public Chat - DragonVR's Realm</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;700&display=swap');

body {
  margin: 0;
  background: linear-gradient(180deg,#0b0a0f,#1a120b);
  font-family: 'Montserrat', sans-serif;
  color: white;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

header {
  background:#330b00;
  padding:1rem;
  font-family:'Anton';
  font-size:2.5rem;
  text-align:center;
  color:#ff4500;
}

#ownerStatus {
  font-size:1rem;
  color:#0f0;
  margin-top:0.4rem;
}

main {
  max-width:900px;
  margin:2rem auto;
  padding:1rem;
  flex-grow:1;
}

#chatWindow {
  height:400px;
  background:#1a0b00;
  border:2px solid #ff4500;
  border-radius:10px;
  padding:1rem;
  overflow-y:auto;
}

.message {
  margin-bottom:0.6rem;
  background:rgba(255,69,0,0.2);
  padding:0.4rem 0.6rem;
  border-radius:6px;
  display:flex;
  gap:0.4rem;
  align-items:center;
}

.owner-crown {
  font-size:1.2rem;
}

.username {
  font-weight:700;
  color:#ff6a00;
}

form {
  display:flex;
  gap:0.5rem;
  margin-top:1rem;
}

input {
  background:#220900;
  border:2px solid #ff4500;
  border-radius:20px;
  padding:0.5rem 1rem;
  color:white;
  flex-grow:1;
}

button {
  background:#ff4500;
  border:none;
  border-radius:20px;
  padding:0 1.5rem;
  color:white;
  font-weight:700;
  cursor:pointer;
}

button:disabled {
  opacity:0.5;
  cursor:not-allowed;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<header>
  Public Chat
  <div id="ownerStatus"></div>
</header>

<main>
  <div id="chatWindow"></div>

  <form id="chatForm">
    <input id="username" placeholder="Your name" maxlength="20" required>
    <input id="messageInput" placeholder="Type message..." maxlength="200" required>
    <button id="sendBtn" disabled>Send</button>
  </form>
</main>

<script>
// ================= OWNER CONFIG =================
const OWNER_SECRET = "Dragon-IS-A-LEGEND!!!";
const isOwner = localStorage.getItem("ownerToken") === OWNER_SECRET;

// ================= FIREBASE =================
firebase.initializeApp({
  apiKey: "AIzaSyDIjJYvHsSKg3IRHlmynXFmfPri98nrtLU",
  authDomain: "dragonvr-s-realm-d91d0.firebaseapp.com",
  databaseURL: "https://dragonvr-s-realm-d91d0-default-rtdb.firebaseio.com",
  projectId: "dragonvr-s-realm-d91d0"
});

const db = firebase.database();
const messagesRef = db.ref("chatMessages");

// ================= DOM =================
const chatWindow = document.getElementById("chatWindow");
const form = document.getElementById("chatForm");
const usernameInput = document.getElementById("username");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const ownerStatus = document.getElementById("ownerStatus");

// ================= OWNER STATUS =================
if (isOwner) {
  ownerStatus.textContent = "ðŸ‘‘ Owner Online";
}

// ================= SEND ENABLE =================
function updateBtn() {
  sendBtn.disabled = !(usernameInput.value && messageInput.value);
}
usernameInput.oninput = updateBtn;
messageInput.oninput = updateBtn;

// ================= ADD MESSAGE =================
function addMessage(msg) {
  const div = document.createElement("div");
  div.className = "message";

  if (msg.isOwner) {
    const crown = document.createElement("span");
    crown.className = "owner-crown";
    crown.textContent = "ðŸ‘‘";
    div.appendChild(crown);
  }

  const user = document.createElement("span");
  user.className = "username";
  user.textContent = msg.username + ":";

  const text = document.createElement("span");
  text.textContent = " " + msg.text;

  div.append(user, text);
  chatWindow.appendChild(div);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

// ================= LIVE LISTENER =================
messagesRef.limitToLast(100).on("child_added", snap => {
  addMessage(snap.val());
});

// ================= SEND MESSAGE =================
form.addEventListener("submit", e => {
  e.preventDefault();

  const username = usernameInput.value.trim();
  const text = messageInput.value.trim();
  if (!username || !text) return;

  // OWNER COMMANDS
  if (isOwner && text.startsWith("/")) {
    if (text === "/clear") {
      messagesRef.remove();
      chatWindow.innerHTML = "";
      messageInput.value = "";
      return;
    }
    if (text.startsWith("/announce ")) {
      messagesRef.push({
        username: "Announcement",
        text: text.replace("/announce ",""),
        isOwner: true
      });
      messageInput.value = "";
      return;
    }
  }

  messagesRef.push({
    username,
    text,
    isOwner
  });

  messageInput.value = "";
  updateBtn();
});
</script>

</body>
</html>
