<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Public Chat - DragonVR's Realm</title>

<link rel="icon" href="https://i.imgur.com/75ryOK9.png" type="image/png">

<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;700&display=swap');

body {
  margin: 0;
  background: linear-gradient(180deg, #0b0a0f 0%, #1a120b 80%);
  color: #fff;
  font-family: 'Montserrat', sans-serif;
}

header {
  font-family: 'Anton', sans-serif;
  font-size: 2.8rem;
  text-align: center;
  color: #ff6a00;
  text-shadow: 0 0 3px #ff8c00, 0 0 6px #ff5e00, 0 0 9px #ff3c00;
  margin-bottom: 2rem;
}

main {
  max-width: 900px;
  margin: 1rem auto;
  padding: 1rem;
}

#ownerLogin {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

#ownerLogin input {
  flex: 1;
  padding: 0.5rem;
  border-radius: 20px;
  border: 2px solid #ff4500;
  background: #220900;
  color: #fff;
}

#ownerLogin button {
  background: #ff4500;
  border: none;
  border-radius: 20px;
  padding: 0 1.2rem;
  font-weight: bold;
  cursor: pointer;
}

#chatWindow {
  background: #1a0b00;
  border: 2px solid #ff4500;
  border-radius: 12px;
  height: 500px;
  padding: 1rem;
  overflow-y: auto;
}

.message {
  margin-bottom: 0.7rem;
  padding: 0.4rem 0.6rem;
  border-radius: 8px;
  background: rgba(255,69,0,0.2);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  position: relative;
  border: 2px solid transparent;
}

.owner-message {
  border: 2px solid gold !important;
  box-shadow: 0 0 12px rgba(255, 215, 0, 0.5);
  background: rgba(40, 30, 0, 0.6) !important;
  animation: ownerGlow 2s infinite alternate;
}

@keyframes ownerGlow {
  from { box-shadow: 0 0 8px rgba(255, 215, 0, 0.4); }
  to { box-shadow: 0 0 18px rgba(255, 215, 0, 0.7); }
}

.message:hover .trash-btn, .message:hover .mute-btn {
  display: inline;
}

.trash-btn {
  display: none;
  position: absolute;
  right: 10px;
  cursor: pointer;
  color: #888;
  font-size: 1.2rem;
}

.mute-btn {
  display: none;
  position: absolute;
  right: 40px;
  cursor: pointer;
  width: 20px;
  height: 20px;
  filter: grayscale(100%);
  opacity: 0.6;
}

.mute-btn:hover, .trash-btn:hover {
  opacity: 1;
}

.owner-crown {
  font-size: 1.1rem;
  color: gold;
  filter: drop-shadow(0 0 4px gold);
}

.admin-star {
  font-size: 1.1rem;
  color: gold;
  filter: drop-shadow(0 0 2px gold);
}

.username {
  font-weight: 700;
  color: #ff6a00;
}

#inputWrapper {
  position: relative;
  margin-top: 1rem;
}

#muteOverlay {
  display: none;
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.85);
  color: #ff4444;
  font-weight: bold;
  text-align: center;
  padding: 0.5rem;
  border-radius: 20px;
  z-index: 100;
  line-height: 2;
}

form {
  display: flex;
  gap: 0.5rem;
}

input {
  padding: 0.5rem;
  border-radius: 20px;
  border: 2px solid #ff4500;
  background: #220900;
  color: #fff;
}

button {
  background: #ff4500;
  border: none;
  border-radius: 20px;
  padding: 0 1.2rem;
  font-weight: bold;
  cursor: pointer;
}

footer {
  background: #1a0b0b;
  text-align: center;
  padding: 1.5rem 1rem;
  font-size: 0.9rem;
  color: #aaa;
  box-shadow: inset 0 3px 15px #ff450050;
}
footer a {
  color: #ff4500;
  font-weight: 700;
  text-decoration: none;
}

.notification {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: #220900;
  border: 2px solid #ff4500;
  border-radius: 12px;
  padding: 0.7rem 1rem;
  color: #fff;
  font-weight: bold;
  animation: slideFade 3s forwards;
  z-index: 1000;
}
@keyframes slideFade {
  0% {opacity: 0; transform: translate(-50%, -20px);}
  10% {opacity: 1; transform: translate(-50%, 0);}
  80% {opacity: 1; transform: translate(-50%, 0);}
  100% {opacity: 0; transform: translate(-50%, -20px);}
}

#deleteModal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1a0b00;
  border: 2px solid #ff4500;
  border-radius: 16px;
  padding: 1rem 2rem;
  z-index: 2000;
  width: 300px;
  text-align: center;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<header>üî• DragonVR Live Chat üî•</header>

<main>
  <div id="ownerLogin">
    <input id="ownerPassword" placeholder="Owner/Admin Password" type="password" />
    <button id="ownerLoginBtn">Login</button>
    <input id="systemMessageInput" placeholder="System Message" maxlength="200"
      style="display:none; padding:0.4rem 0.6rem; border-radius:20px; border:2px solid #fff; background:#111; color:#fff; outline:none; width:160px;" />
    <button id="systemSendBtn"
      style="display:none; padding:0.4rem 0.8rem; border:none; border-radius:20px; background:#fff; color:#000; font-weight:bold; cursor:pointer;">
      Send
    </button>
  </div>

  <div id="chatWindow"></div>

  <div id="inputWrapper">
    <div id="muteOverlay">You've been muted <span id="countdown">00:00</span></div>
    <form id="chatForm">
      <input id="username" placeholder="Name" maxlength="20" required />
      <input id="messageInput" placeholder="Message" maxlength="200" required />
      <button type="submit">Send</button>
    </form>
  </div>
</main>

<div id="deleteModal">
  <p>Are you sure you want to delete this message?</p>
  <button id="cancelDelete">Cancel</button>
  <button id="confirmDelete">Delete</button>
</div>

<footer>
  ¬© 2025 DragonVR. All rights reserved. <a href="https://dragonmasterxxx.github.io/dragonvr-realm/">Back to Home</a>
</footer>

<script>
// ---------------- CONFIG ----------------
const MIC_NORMAL = "https://i.imgur.com/XCFidkl.png"; 
const MIC_MUTED = "https://i.imgur.com/jYohHJ8.png"; 

const OWNER_PASSWORD = "Dragon-IS-A-LEGEND!!!";
const ADMIN_PASSWORD = "ADMINS-ARE-COOL-TOO!!!";

const COOLDOWN_MS = 3000;
const MUTE_DURATION_MS = 30 * 60 * 1000;

const profanity = ["fuck","f*ck","f**k","f***","shit","sh*t","s**t","sh1t","bitch","b*tch","bi**h","b!tch","asshole","a**hole","a**h0le","dick","d!ck","d1ck","cunt","c*nt","c**t","slut","whore","wh0re","bastard","damn","bollocks","bugger","twat","prick","motherfucker","m*therf*cker","m0therfucker","fag","faggot","nigger","n1gger","piss","p*ss","p***","cock","c0ck","pussy","pu55y","tit","t1t","wank","douche","douchebag","skank","slapper","jackass","twunt","arse","arsehole","clit","cum","shag","bollok","tosser","git","slag","nazi","kike"];

// ---------------- FIREBASE ----------------
firebase.initializeApp({
  apiKey: "AIzaSyDIjJYvHsSKg3IRHlmynXFmfPri98nrtLU",
  authDomain: "dragonvr-s-realm-d91d0.firebaseapp.com",
  databaseURL: "https://dragonvr-s-realm-d91d0-default-rtdb.firebaseio.com",
  projectId: "dragonvr-s-realm-d91d0"
});

const db = firebase.database();
const messagesRef = db.ref("chatMessages");
const usersRef = db.ref("chatUsers");
const mutesRef = db.ref("mutedUsers");

// ---------------- STATE ----------------
let isOwner = false;
let isAdmin = false;
let lastMessageTime = 0;
let messageToDeleteKey = null;
let currentUsername = "";
let mutedUntil = 0;
let countdownInterval;

// ---------------- HELPERS ----------------
function cleanText(t) {
  profanity.forEach(w => {
    const escaped = w.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    t = t.replace(new RegExp(escaped, "gi"), "****");
  });
  return t;
}

function showNotification(text) {
  const n = document.createElement("div");
  n.className = "notification";
  n.textContent = text;
  document.body.appendChild(n);
  setTimeout(() => n.remove(), 3000);
}

function startCountdown() {
  clearInterval(countdownInterval);
  countdownInterval = setInterval(() => {
    const r = mutedUntil - Date.now();
    if (r <= 0) {
      clearInterval(countdownInterval);
      muteOverlay.style.display = "none";
      messageInput.disabled = false;
      mutedUntil = 0;
    } else {
      muteOverlay.style.display = "block";
      messageInput.disabled = true;
      const m = Math.floor(r / 60000);
      const s = Math.floor((r % 60000) / 1000);
      countdown.textContent = `${m}:${s < 10 ? "0" : ""}${s}`;
    }
  }, 1000);
}

function refreshChatUI() {
  chatWindow.innerHTML = "";
  messagesRef.orderByChild("time").once("value", snapshot => {
    snapshot.forEach(child => {
      addMessage(child.val(), child.key);
    });
  });
}

// ---------------- MESSAGES ----------------
function addMessage(msg, key) {
  if (!msg || !msg.text) return;

  const div = document.createElement("div");
  div.className = "message";
  div.dataset.key = key;

  if (msg.isOwner && msg.username !== "System") {
    div.classList.add("owner-message");
  }

  let badge = "";
  let nameStyle = "";
  let textStyle = "";

  if (msg.isOwner) {
    badge = "üëë";
    textStyle = 'style="color: yellow; font-weight:600"';
  } else if (msg.isAdmin) {
    badge = "‚≠ê";
    nameStyle = 'style="color: yellow"';
  }

  div.innerHTML = msg.username === "System"
    ? `<span class="username" style="color:#fff">System:</span> <span>${msg.text}</span>`
    : `${badge ? `<span>${badge}</span>` : ""}
       <span class="username" ${nameStyle}>${msg.username}:</span>
       <span ${textStyle}>${msg.text}</span>`;

  // -------- MUTE BUTTON (OWNER + ADMIN) --------
  if ((isOwner || isAdmin) && msg.username !== currentUsername && msg.username !== "System") {
    const muteBtn = document.createElement("img");
    muteBtn.className = "mute-btn";
    
    // POSITION LOGIC: 
    // If Admin (but not Owner), put mic in the trashcan's spot (10px).
    // If Owner, keep it at 40px so the trashcan can fit at 10px.
    if (isAdmin && !isOwner) {
      muteBtn.style.right = "10px";
    } else {
      muteBtn.style.right = "40px";
    }

    mutesRef.child(msg.username).on("value", snap => {
      const until = snap.val() || 0;
      muteBtn.src = Date.now() < until ? MIC_MUTED : MIC_NORMAL;
    });

    muteBtn.onclick = () => {
      mutesRef.child(msg.username).once("value").then(snap => {
        const until = snap.val() || 0;
        if (Date.now() < until) {
          mutesRef.child(msg.username).remove();
          showNotification(`${msg.username} unmuted`);
        } else {
          mutesRef.child(msg.username).set(Date.now() + MUTE_DURATION_MS);
          showNotification(`${msg.username} muted for 30 minutes`);
        }
      });
    };
    div.appendChild(muteBtn);
  }

  // -------- TRASH BUTTON RULES --------
  // Owner can delete everything. 
  // Regular users can delete their OWN messages.
  // Admins CANNOT delete (unless it's their own message).
  const isMyOwn = (msg.username === currentUsername);
  const canDelete = isOwner || (isMyOwn && msg.username !== "System");

  if (canDelete) {
    const trash = document.createElement("span");
    trash.className = "trash-btn";
    trash.textContent = "üóëÔ∏è";
    trash.onclick = () => {
      messageToDeleteKey = key;
      deleteModal.style.display = "block";
    };
    div.appendChild(trash);
  }

  chatWindow.appendChild(div);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

// ---------------- SYSTEM MESSAGE ----------------
function sendSystemMessage() {
  if (!isOwner) return;
  const text = systemMessageInput.value.trim();
  if (!text) return;

  messagesRef.push({
    username: "System",
    text: text,
    isOwner: true,
    isAdmin: false,
    time: Date.now()
  });
  systemMessageInput.value = "";
}

systemSendBtn.onclick = sendSystemMessage;
systemMessageInput.onkeydown = e => {
  if (e.key === "Enter") {
    e.preventDefault();
    sendSystemMessage();
  }
};

// ---------------- LOGIN ----------------
ownerLoginBtn.onclick = () => {
  const pass = ownerPassword.value;
  if (pass === OWNER_PASSWORD) {
    isOwner = true;
    isAdmin = true;
    showNotification("Owner privileges enabled!");
    systemMessageInput.style.display = "inline-block";
    systemSendBtn.style.display = "inline-block";
    refreshChatUI();
  } else if (pass === ADMIN_PASSWORD) {
    isAdmin = true;
    isOwner = false;
    showNotification("Admin privileges enabled!");
    systemMessageInput.style.display = "none";
    systemSendBtn.style.display = "none";
    refreshChatUI();
  } else {
    showNotification("Incorrect password!");
  }
};

// ---------------- SEND MESSAGE ----------------
chatForm.onsubmit = e => {
  e.preventDefault();
  const u = username.value.trim();
  const t = messageInput.value.trim();
  if (!u || !t) return;

  if (t === "/clear" && isOwner) {
    messagesRef.remove();
    messageInput.value = "";
    showNotification("Chat Cleared!");
    return;
  }

  if (Date.now() < mutedUntil) return showNotification("You are muted");
  const now = Date.now();
  if (!isOwner && !isAdmin && now - lastMessageTime < COOLDOWN_MS)
    return showNotification("Slow down");

  messagesRef.push({
    username: u,
    text: (isOwner || isAdmin) ? t : cleanText(t),
    isOwner: isOwner,
    isAdmin: isAdmin,
    time: now
  });

  messageInput.value = "";
  lastMessageTime = now;
};

// ---------------- USER STATE ----------------
username.onchange = () => {
  const n = username.value.trim();
  if (!n) return;
  if (currentUsername) usersRef.child(currentUsername).remove();
  currentUsername = n;
  usersRef.child(n).set(true);
  localStorage.setItem("chatUsername", n);
  mutesRef.child(n).on("value", snap => {
    mutedUntil = snap.val() || 0;
    if (Date.now() < mutedUntil) startCountdown();
  });
};

// ---------------- DELETE ----------------
confirmDelete.onclick = () => {
  if (messageToDeleteKey) messagesRef.child(messageToDeleteKey).remove();
  deleteModal.style.display = "none";
};
cancelDelete.onclick = () => deleteModal.style.display = "none";

// ---------------- INIT ----------------
messagesRef.orderByChild("time").on("child_added", snap => addMessage(snap.val(), snap.key));
messagesRef.on("child_removed", snap => {
  const el = document.querySelector(`[data-key="${snap.key}"]`);
  if (el) el.remove();
});

const saved = localStorage.getItem("chatUsername");
if (saved) {
  username.value = saved;
  username.dispatchEvent(new Event("change"));
}
</script>
</body>
</html>
