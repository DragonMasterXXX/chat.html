<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Public Chat - DragonVR's Realm</title>

<link rel="icon" href="https://i.imgur.com/75ryOK9.png" type="image/png">

<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Montserrat:wght@400;700&display=swap');

body {
  margin: 0;
  background: linear-gradient(180deg, #0b0a0f 0%, #1a120b 80%);
  color: #fff;
  font-family: 'Montserrat', sans-serif;
}

header {
  background: #330b00;
  padding: 1rem;
  font-family: 'Anton', sans-serif;
  color: #ff4500;
  font-size: 2.5rem;
  text-align: center;
  text-shadow: 0 0 3px #ff7a00, 0 0 6px #ff4500;
}

main {
  max-width: 900px;
  margin: 1rem auto;
  padding: 1rem;
}

#chatWindow {
  background: #1a0b00;
  border: 2px solid #ff4500;
  border-radius: 12px;
  height: 500px; /* taller scrollable chat */
  padding: 1rem;
  overflow-y: auto;
}

.message {
  position: relative;
  margin-bottom: 0.7rem;
  padding: 0.4rem 0.6rem;
  border-radius: 8px;
  background: rgba(255,69,0,0.2);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: background 0.2s ease;
}

.message:hover {
  background: rgba(255,69,0,0.3);
}

.owner-crown {
  font-size: 1.1rem;
  color: gold;
  filter: drop-shadow(0 0 4px gold);
}

.username {
  font-weight: 700;
  color: #ff6a00;
}

.trash-btn {
  display: none;
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  font-size: 1rem;
  opacity: 0.7;
}

.message:hover .trash-btn {
  display: inline;
}

form {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
}

input {
  padding: 0.5rem;
  border-radius: 20px;
  border: 2px solid #ff4500;
  background: #220900;
  color: #fff;
}

button {
  background: #ff4500;
  border: none;
  border-radius: 20px;
  padding: 0 1.2rem;
  font-weight: bold;
  cursor: pointer;
}

#ownerLogin {
  margin: 1rem auto;
  max-width: 300px;
  display: flex;
  gap: 0.5rem;
  justify-content: center;
}

.notification {
  position: fixed;
  top: -50px;
  left: 50%;
  transform: translateX(-50%);
  background: #ff4500;
  color: #fff;
  padding: 0.5rem 1rem;
  border-radius: 10px;
  opacity: 0;
  transition: all 0.5s ease;
  z-index: 999;
}

#confirmBox {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1a0b00;
  border: 2px solid #ff4500;
  border-radius: 15px;
  padding: 1rem;
  display: none;
  z-index: 1000;
}

#confirmBox p {
  margin-bottom: 1rem;
}

#confirmBox button {
  margin: 0 0.5rem;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<header>ðŸ”¥ DragonVR Live Chat ðŸ”¥</header>

<div id="ownerLogin">
  <input id="ownerPassword" type="password" placeholder="Owner Password" />
  <button id="ownerLoginBtn">Login</button>
</div>

<main>
  <div id="chatWindow"></div>

  <form id="chatForm">
    <input id="username" placeholder="Name" maxlength="20" required />
    <input id="messageInput" placeholder="Message" maxlength="200" required />
    <button type="submit">Send</button>
  </form>
</main>

<div id="confirmBox">
  <p>Are you sure you want to delete this message?</p>
  <button id="cancelBtn">Cancel</button>
  <button id="deleteBtn">Delete</button>
</div>

<div class="notification" id="notification"></div>

<footer>
  Â© 2025 DragonVR. All rights reserved.
  <a href="https://dragonmasterxxx.github.io/dragonvr-realm/">Back to Home</a>
</footer>

<script>
// ---------------- CONFIG ----------------
const OWNER_NAME = "DragonVR";
const OWNER_PASSWORD = "Dragon-IS-A-LEGEND!!!";
const COOLDOWN_MS = 3000;
const profanity = ["fuck","shit","bitch","asshole","dick"];

let isOwner = false;

// ---------------- FIREBASE ----------------
firebase.initializeApp({
  apiKey: "AIzaSyDIjJYvHsSKg3IRHlmynXFmfPri98nrtLU",
  authDomain: "dragonvr-s-realm-d91d0.firebaseapp.com",
  databaseURL: "https://dragonvr-s-realm-d91d0-default-rtdb.firebaseio.com",
  projectId: "dragonvr-s-realm-d91d0"
});

const db = firebase.database();
const messagesRef = db.ref("chatMessages");
const usersRef = db.ref("chatUsers");

// ---------------- DOM ----------------
const chatWindow = document.getElementById("chatWindow");
const chatForm = document.getElementById("chatForm");
const usernameInput = document.getElementById("username");
const messageInput = document.getElementById("messageInput");
const ownerLoginBtn = document.getElementById("ownerLoginBtn");
const ownerPassword = document.getElementById("ownerPassword");
const notification = document.getElementById("notification");
const confirmBox = document.getElementById("confirmBox");
const cancelBtn = document.getElementById("cancelBtn");
const deleteBtn = document.getElementById("deleteBtn");

let lastMessageTime = 0;
let messageToDelete = null;

// ---------------- HELPERS ----------------
function saveUsername(name) {
  localStorage.setItem("chatUsername", name);
}

function loadUsername() {
  const saved = localStorage.getItem("chatUsername");
  if (saved) usernameInput.value = saved;
}

function cleanText(text) {
  profanity.forEach(w => {
    text = text.replace(new RegExp(w, "gi"), "****");
  });
  return text;
}

function showNotification(text) {
  notification.textContent = text;
  notification.style.top = "20px";
  notification.style.opacity = "1";
  setTimeout(() => {
    notification.style.top = "-50px";
    notification.style.opacity = "0";
  }, 3000);
}

// ---------------- OWNER LOGIN ----------------
ownerLoginBtn.addEventListener("click", () => {
  if (ownerPassword.value === OWNER_PASSWORD) {
    isOwner = true;
    ownerPassword.value = "";
    ownerPassword.disabled = true;
    ownerLoginBtn.disabled = true;
    showNotification("Owner privileges enabled!");
  } else {
    alert("Incorrect password.");
  }
});

// ---------------- MESSAGE DISPLAY ----------------
function addMessage(msg, id) {
  if (!msg || !msg.username || !msg.text) return;

  const div = document.createElement("div");
  div.className = "message";
  div.dataset.id = id;

  if (msg.isOwner) {
    const crown = document.createElement("span");
    crown.className = "owner-crown";
    crown.textContent = "ðŸ‘‘";
    div.appendChild(crown);
  }

  const user = document.createElement("span");
  user.className = "username";
  user.textContent = msg.username + ":";

  const text = document.createElement("span");
  text.textContent = " " + msg.text;

  // Trash button
  const trash = document.createElement("span");
  trash.className = "trash-btn";
  trash.textContent = "ðŸ—‘ï¸";
  trash.addEventListener("click", () => {
    if (isOwner || msg.username === usernameInput.value.trim()) {
      messageToDelete = {id, div};
      confirmBox.style.display = "block";
    }
  });

  div.append(user, text, trash);
  chatWindow.appendChild(div);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

// ---------------- CONFIRM DELETE ----------------
cancelBtn.addEventListener("click", () => {
  messageToDelete = null;
  confirmBox.style.display = "none";
});

deleteBtn.addEventListener("click", () => {
  if (!messageToDelete) return;
  messagesRef.child(messageToDelete.id).remove();
  messageToDelete.div.remove();
  confirmBox.style.display = "none";
});

// ---------------- JOIN/LEAVE ----------------
function userJoinLeave(name, join = true) {
  messagesRef.push({
    username: "System",
    text: join ? `${name} joined the chat.` : `${name} left the chat.`,
    isOwner: false,
    time: Date.now(),
    system: true
  });
}

// ---------------- LOAD USER ----------------
loadUsername();
usernameInput.addEventListener("input", () => {
  saveUsername(usernameInput.value.trim());
});

// ---------------- LISTEN MESSAGES ----------------
messagesRef.orderByChild("time").on("child_added", snap => {
  const val = snap.val();
  addMessage(val, snap.key);
});

// ---------------- SEND MESSAGE ----------------
chatForm.addEventListener("submit", e => {
  e.preventDefault();

  const now = Date.now();
  const username = usernameInput.value.trim();
  let text = cleanText(messageInput.value.trim());
  if (!username || !text) return;

  const ownerFlag = isOwner || username === OWNER_NAME;

  if (!ownerFlag && now - lastMessageTime < COOLDOWN_MS) return;

  // Commands
  if (ownerFlag && text === "/clear") {
    messagesRef.remove();
    chatWindow.innerHTML = "";
    messageInput.value = "";
    return;
  }

  messagesRef.push({
    username,
    text,
    isOwner: ownerFlag,
    time: now
  });

  messageInput.value = "";
  lastMessageTime = now;
});

// ---------------- USER JOIN ----------------
usersRef.child(usernameInput.value.trim()).set(true);
userJoinLeave(usernameInput.value.trim(), true);

// ---------------- WINDOW UNLOAD ----------------
window.addEventListener("beforeunload", () => {
  userJoinLeave(usernameInput.value.trim(), false);
  usersRef.child(usernameInput.value.trim()).remove();
});
</script>

</body>
</html>
